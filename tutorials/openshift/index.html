---
layout: default
title:  Openshift deployment howto - Alf.io
categories: tutorial
---

<div class="page-header">
    <h1>How to deploy Alf.io on <a href="openshift.com" target="_blank">Openshift</a> (Wildfly 8.2+)</h1>
</div>

<div class="alert alert-warning">
    <h3>This tutorial apply to Openshift v2, which is no longer available. <br><small>The new tutorial is currently being <a target="_blank" href="https://github.com/alfio-event/alf.io/issues/403">developed</a>. Any help would be really appreciated!</small></h3>
</div>

<div class="page-header">
    <h3>Openshift application creation</h3>
</div>

<ul class="list-unstyled">
    <li class="media">
        <div class="media-left">
            <a href="images/001.png" target="_blank"><img class="media-object"
                                                          srcset="images/001_mini.png 1x, images/001.png 2x"></a>
        </div>
        <div class="media-body">
            <h4 class="media-heading">Create new application</h4>
            <p>Click on <em>Add new application</em> on your openshift home</p>
        </div>
    </li>
    <li class="media">
        <div class="media-left">
            <a href="images/002.png" target="_blank"><img class="media-object"
                                                          srcset="images/002_mini.png 1x, images/002.png 2x"></a>
        </div>
        <div class="media-body">
            <h4 class="media-heading">Add application server cartridge</h4>
            <p>Use the search input text to find the application server named "Wildfly Application Server 8.2.0.Final"
                (or newer)</p>
        </div>
    </li>
    <li class="media">
        <div class="media-left">
            <a href="images/003.png" target="_blank"><img class="media-object"
                                                          srcset="images/003_mini.png 1x, images/003.png 2x"></a>
        </div>
        <div class="media-body">
            <h4 class="media-heading">Configure the Application Server</h4>
            <ul>
                <li>Define a public address for your application inserting the application name and selecting the domain
                    on the right. The final URL will look like "https://myapplication-mydomain.rhcloud.com"
                </li>
                <li>Select the gear size for your application</li>
                <li>Select scaling profile. We would suggest to select the "scale with web traffic" option in order to scale horizontally</li>
            </ul>
        </div>
    </li>

</ul>

<div class="page-header">
    <h3>Database configuration</h3>
</div>

<div style="margin-top:20px;">

    <!-- Nav tabs -->
    <ul class="nav nav-tabs" role="tablist">
        <li role="presentation" class="active"><a href="#elephantsql" aria-controls="elephantsql" role="tab" data-toggle="tab">use Elephant SQL <span class="label label-success">new!</span></a></li>
        <li role="presentation"><a href="#own" aria-controls="own" role="tab" data-toggle="tab">Create your own database</a></li>
    </ul>

    <!-- Tab panes -->
    <div class="tab-content">
        <div role="tabpanel" class="tab-pane active" id="elephantsql">

            <div class="alert alert-warning" style="margin-top: 30px;"><i class="fa fa-warning"></i> This option requires alf.io 1.7.4+</div>

            <ul class="list-unstyled">
                <li class="media">
                    <div class="media-left">
                        <img class="media-object" src="http://www.elephantsql.com/images/elephant_256.png" alt="Elephant SQL logo">
                    </div>
                    <div class="media-body">
                        <h4 class="media-heading"><a href="http://www.elephantsql.com" target="_blank">Elephant SQL</a> is a PostgreSQL database hosting service.</h4>
                        <p>Follow the <a href="http://www.elephantsql.com/docs/index.html">official documentation</a> to get your database up and running in a few seconds.</p>
                        <p>For maximizing performances, we would suggest you to deploy your database in the same <a href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-regions-availability-zones.html" target="_blank">availability zone</a> of your application.</p>
                    </div>
                </li>
                <li class="media">
                    <div class="media-body">
                        <h4 class="media-heading">Configure your application to use the new database.</h4>
                        <p>Retrieve the Database connection string from the console</p>
                    </div>
                    <div class="media-right">
                        <a href="images/009.png" target="_blank"><img class="media-object" srcset="images/009_mini.png 1x, images/009.png 2x"></a>
                    </div>
                </li>
                <li class="media">
                    <h4>Set the following variables in your application:</h4>
                    <pre>$ rhc set-env ELEPHANTSQL_MAX_CONNS=20<br>$ rhc set-env ELEPHANTSQL_URI=<i>database-URL</i></pre>
                    <p><i class="fa fa-info-circle"></i> you should distribute the connections towards your instances.<br>
                    This means that if you are planning to scale horizontally, you should set ELEPHANTSQL_MAX_CONNS=<i>max_allowed_conns / max_instances</i></p>
                </li>
            </ul>
        </div>
        <div role="tabpanel" class="tab-pane" id="own">
            <ul class="list-unstyled">

                <li class="media">
                    <div class="media-left">
                        <a href="images/004.png" target="_blank"><img class="media-object"
                                                                      srcset="images/004_mini.png 1x, images/004.png 2x"></a>
                    </div>
                    <div class="media-body">
                        <h4 class="media-heading">Add a database cartridge</h4>
                        <p>Click on <em>Add Postgresql 9.2</em> link in order to create a database cartridge. Please note that currently Alf.io
                            supports only Postgresql on Openshift</p>
                    </div>
                </li>
                <li class="media">
                    <div class="media-left">
                        <a href="images/005.png" target="_blank"><img class="media-object"
                                                                      srcset="images/005_mini.png 1x, images/005.png 2x"></a>
                    </div>
                    <div class="media-body">
                        <h4 class="media-heading">Save Postgres cartridge</h4>
                        <p>Click on <em>Add Cartridge</em> link to create the cartridge</p>
                    </div>
                </li>
                <li class="media">
                    <div class="media-left">
                        <a href="images/006.png" target="_blank"><img class="media-object"
                                                                      srcset="images/006_mini.png 1x, images/006.png 2x"></a>
                    </div>
                    <div class="media-body">
                        <h4 class="media-heading">Restart your application</h4>
                        <p>The application and the database cartridges have been successfully created but not yet linked each other. To
                            do that, you must restart your application. Just click on <em>Restart Application</em>, as shown</p>
                    </div>
                </li>
            </ul>
        </div>
    </div>

</div>

<div class="page-header">
    <h3>Deploy Alf.io</h3>
    <span>Before we go any further, please ensure that you're already able to access your application remotely. You may need extra configuration, see <a href="https://developers.openshift.com/managing-your-applications/remote-connection.html" target="_blank">official reference</a></span>
</div>

<ul class="list-unstyled">
    <li class="media">
        <div class="media-body">
            <h4 class="media-heading">Retrieve application git repository</h4>
            <span>In order to upload the application you need to access its source repository</span>
        </div>
        <div class="media-right">
            <a href="images/007.png" target="_blank"><img class="media-object" srcset="images/007_mini.png 1x, images/007.png 2x"></a>
        </div>

        <h4>perform installation</h4>
        <ul class="list-unstyled">
            <li>download the latest alfio.war from <a href="https://github.com/exteso/alf.io/releases/latest" target="_blank">GitHub</a> under <i>/tmp</i></li>
            <li>clone the application repository locally:
                <pre>$ git clone ssh://<i>insert-repo-url-here</i>/</pre></li>
            <li>Delete unnecessary files: <br/>
                <pre>$ cd <i>application</i><br>$ git rm -rf pom.xml README.md src</pre>
            </li>
            <li>copy alf.io war: <br>
                <pre>$ cp /tmp/alfio-<i>version</i>.war deployments/ROOT.war</pre></li>
            <li>commit the modifications:
                <pre>$ git commit -m "Look ma! I just installed alf.io!"</pre>
            </li>
            <li>
                Limit the number of threads created by activemq/artemis (see <a href="https://developer.jboss.org/thread/268397" target="_blank">forum</a> and <a href="https://issues.jboss.org/browse/JBEAP-2947" target="_blank">issue</a>) and increase the memory reserved to the application<br>
                <pre>$ rhc set-env JAVA_OPTS_EXT="-Dactivemq.artemis.client.global.thread.pool.max.size=20 -Xmx384m" -n <i>mydomain</i> -a <i>myapplication</i></pre>
            </li>
            <li>
                Push the changes:<br>
                <pre>$ git push</pre>
            </li>
            <li>...and wait for the application to start</li>
        </ul>
    </li>
</ul>

<div class="page-header">
    <h3>Retrieve admin password</h3>
</div>

<ul class="list-unstyled">
    <li class="media">
        <div class="media-body">
            <ul class="list-unstyled">
                <p>check the log</p>
                <pre>$ rhc tail -n <i>mydomain</i> -a <i>myapplication</i> -f wildfly/logs/alfio.log</pre>
                <p>and find the auto-generated password.</p>
            </ul>
        </div>
        <div class="media-bottom">
            <a href="images/008.png" target="_blank"><img class="media-object"
                                                          srcset="images/008_mini.png 1x, images/008.png 2x"></a>
        </div>
        <p>Then you can access the admin under <code>https://appname-yourdomain.rhcloud.com/admin/</code></p>
    </li>
</ul>
